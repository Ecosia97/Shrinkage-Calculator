<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="favicon.png" type="image/png">
  <title>Shrinkage Calculator (3D Printing)</title>
  <style>
    :root { --bg:#0b0d10; --card:#131720; --muted:#9aa4b2; --text:#e6edf3; --accent:#4da3ff; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:linear-gradient(160deg,#0b0d10,#0e1116); color:var(--text); }
    .wrap { max-width: 960px; margin: 40px auto; padding: 20px; }
    .card { background: var(--card); border: 1px solid #1f2633; border-radius: 16px; padding: 24px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    h1 { margin: 0 0 8px; font-size: clamp(22px, 4vw, 32px); }
    p.lead { margin: 0 0 18px; color: var(--muted); }
    .grid { display: grid; grid-template-columns: repeat(12,1fr); gap: 16px; align-items: end; }
    .field { grid-column: span 12; }
    @media (min-width:720px){ .field.sm6{ grid-column: span 6; } .field.sm4{ grid-column: span 4; } .field.sm3{ grid-column: span 3; } }
    label { display:block; font-size: 14px; color: var(--muted); margin: 0 0 6px; }
    select, input { width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid #2a3141; background:#0f1218; color: var(--text); outline: none; }
    input:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(77,163,255,.25); }
    .results { margin-top: 18px; display: grid; gap: 12px; }
    .result { background:#0f131b; border:1px solid #222a38; border-radius: 12px; padding: 12px 14px; display:flex; justify-content: space-between; gap:12px; align-items:center; }
    .result .label { color: var(--muted); font-size: 14px; }
    .result .value { font-variant-numeric: tabular-nums; font-weight: 600; }
    .hint { color: var(--muted); font-size: 13px; margin-top: 10px; }
    .footer { margin-top: 18px; color: var(--muted); font-size: 12px; text-align: center; }
    .row { display:flex; flex-wrap:wrap; gap:16px; align-items:flex-end; }
    .field.inline { flex:1 1 220px; }
    .pill { display:inline-block; padding: 6px 10px; border-radius:999px; background: #10243a; border:1px solid #1f3b5e; color:#cde6ff; font-size:12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1 id="title">üßÆ Shrinkage Calculator</h1>
      <p class="lead" id="lead">Enter the <strong>Nominal size (Original)</strong>, the <strong>Measured size (Printed)</strong>, and your <strong>current correction (%)</strong>. The tool computes the measured shrinkage, the recommended <em>new correction (%)</em>, and deltas.</p>

      <div class="row" style="margin-bottom: 8px;">
        <div class="field inline" style="max-width:260px;">
          <label for="lang" id="langLabel">Language</label>
          <select id="lang"></select>
        </div>
        <div class="field inline" style="max-width:200px;">
          <label for="unit" id="unitLabel">Unit</label>
          <select id="unit">
            <option value="mm">Millimeters (mm)</option>
            <option value="inch">Inches (inch)</option>
          </select>
        </div>
        <div class="field inline" style="max-width:220px;">
          <span class="pill" id="unitNote">All values in mm</span>
        </div>
      </div>

      <div class="grid">
        <div class="field sm4">
          <label for="original" id="originalLabel">Original (Nominal)</label>
          <input id="original" type="text" inputmode="decimal" placeholder="e.g., 100" value="" />
        </div>
        <div class="field sm4">
          <label for="printed" id="printedLabel">Printed (Measured)</label>
          <input id="printed" type="text" inputmode="decimal" placeholder="e.g., 99.7" value="" />
        </div>
        <div class="field sm4">
          <label for="currentCorr" id="currentCorrLabel">Current correction (%)</label>
          <input id="currentCorr" type="text" inputmode="decimal" placeholder="e.g., 0 (if none)" value="" />
        </div>
      </div>

      <div class="results" id="results" aria-live="polite"></div>

      <p class="hint" id="hint">Note: Decimal separators <strong>comma</strong> or <strong>dot</strong> are accepted. The unit only affects display, not the formula ‚Äî both values must use the same unit.</p>

      <div class="footer" id="footer">Formulas: shrinkage % = (O ‚àí P)/O √ó 100 ¬∑ scale = O/P ¬∑ if current correction = s‚Çí (%), then f‚Çí = 1+s‚Çí/100 and recommended new correction s‚Çô = 100¬∑((O¬∑f‚Çí/P)‚àí1)</div>
    </div>
  </div>

  <script>
    const $ = (s) => document.querySelector(s);

    const languageOptions = [
      { code: 'en-US', name: 'English (US)' },
      { code: 'de',    name: 'Deutsch' },
      { code: 'fr',    name: 'Fran√ßais' },
      { code: 'es',    name: 'Espa√±ol' },
      { code: 'it',    name: 'Italiano' },
      { code: 'pt-PT', name: 'Portugu√™s (Portugal)' },
      { code: 'nl',    name: 'Nederlands' },
      { code: 'da',    name: 'Dansk' },
      { code: 'sv',    name: 'Svenska' },
      { code: 'fi',    name: 'Suomi' },
      { code: 'pl',    name: 'Polski' },
      { code: 'cs',    name: 'ƒåe≈°tina' },
      { code: 'sk',    name: 'Slovenƒçina' },
      { code: 'hu',    name: 'Magyar' },
      { code: 'ro',    name: 'Rom√¢nƒÉ' },
      { code: 'bg',    name: '–ë—ä–ª–≥–∞—Ä—Å–∫–∏' },
      { code: 'el',    name: 'ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨' },
      { code: 'et',    name: 'Eesti' },
      { code: 'lv',    name: 'Latvie≈°u' },
      { code: 'lt',    name: 'Lietuvi≈≥' },
      { code: 'sl',    name: 'Sloven≈°ƒçina' },
      { code: 'hr',    name: 'Hrvatski' },
      { code: 'mt',    name: 'Malti' },
      { code: 'ga',    name: 'Gaeilge' },
      { code: 'nb',    name: 'Norsk (Bokm√•l)' },
      { code: 'is',    name: '√çslenska' },
      { code: 'sq',    name: 'Shqip' },
      { code: 'mk',    name: '–ú–∞–∫–µ–¥–æ–Ω—Å–∫–∏' },
      { code: 'sr',    name: '–°—Ä–ø—Å–∫–∏' },
      { code: 'bs',    name: 'Bosanski' },
      { code: 'uk',    name: '–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞' },
      { code: 'be',    name: '–ë–µ–ª–∞—Ä—É—Å–∫–∞—è' },
      { code: 'ru',    name: '–†—É—Å—Å–∫–∏–π' },
      { code: 'tr',    name: 'T√ºrk√ße' },
      { code: 'cy',    name: 'Cymraeg' },
      { code: 'gd',    name: 'G√†idhlig' },
      { code: 'lb',    name: 'L√´tzebuergesch' },
      { code: 'ca',    name: 'Catal√†' },
      { code: 'eu',    name: 'Euskara' },
      { code: 'gl',    name: 'Galego' }
    ];

    const tDict = {
      'en-US': {
        title: 'üßÆ Shrinkage Calculator',
        lead: 'Enter the <strong>Nominal size (Original)</strong>, the <strong>Measured size (Printed)</strong>, and your <strong>current correction (%)</strong>. The tool computes the measured shrinkage, the recommended <em>new correction (%)</em>, and deltas.',
        langLabel: 'Language',
        unitLabel: 'Unit',
        originalLabel: 'Original (Nominal)',
        printedLabel: 'Printed (Measured)',
        currentCorrLabel: 'Current correction (%)',
        unit_mm: 'Millimeters (mm)',
        unit_inch: 'Inches (inch)',
        unitNote: (u)=>`All values in ${u}`,
        hint: 'Note: Decimal separators <strong>comma</strong> or <strong>dot</strong> are accepted. The unit only affects display, not the formula ‚Äî both values must use the same unit.',
        footer: 'Formulas: shrinkage % = (O ‚àí P)/O √ó 100 ¬∑ scale = O/P ¬∑ if current correction = s‚Çí (%), then f‚Çí = 1+s‚Çí/100 and recommended new correction s‚Çô = 100¬∑((O¬∑f‚Çí/P)‚àí1)',
        status_invalid: 'Please enter valid, positive numbers.',
        statusLabel: 'Status',
        res_shrinkage: 'Measured shrinkage (percent) ‚Äî X',
        res_scale: 'Scale factor (to correct)',
        res_corrpct: 'Recommended new correction (%)',
        res_delta: 'Change vs current (%)',
        res_abs_error: 'Absolute error',
        phOriginal: 'e.g., 100',
        phPrinted: 'e.g., 99.7',
        phCurrentCorr: 'e.g., 0 (if none)',
        locale: 'en-US',
      },
      'de': {
        title: 'üßÆ Shrinkage‚ÄëRechner',
        lead: 'Gib <strong>Soll‚ÄëMa√ü (Original)</strong>, <strong>Ist‚ÄëMa√ü (Gedruckt)</strong> und deine <strong>aktuelle Korrektur (%)</strong> ein. Das Tool berechnet die gemessene Shrinkage, die <em>neue empfohlene Korrektur (%)</em> sowie die √Ñnderung.',
        langLabel: 'Sprache',
        unitLabel: 'Einheit',
        originalLabel: 'Original (Soll)',
        printedLabel: 'Gedruckt (Ist)',
        currentCorrLabel: 'Aktuelle Korrektur (%)',
        unit_mm: 'Millimeter (mm)',
        unit_inch: 'Zoll (inch)',
        unitNote: (u)=>`Alle Werte in ${u}`,
        hint: 'Hinweis: Dezimaltrennzeichen <strong>Komma</strong> oder <strong>Punkt</strong> sind erlaubt. Die Einheit beeinflusst nur die Anzeige ‚Äî beide Ma√üe m√ºssen in derselben Einheit eingegeben werden.',
        footer: 'Formeln: Shrinkage % = (O ‚àí P)/O √ó 100 ¬∑ Skalierung = O/P ¬∑ bei aktueller Korrektur s‚Çí (%) gilt f‚Çí = 1+s‚Çí/100 und neue Korrektur s‚Çô = 100¬∑((O¬∑f‚Çí/P)‚àí1)',
        status_invalid: 'Bitte g√ºltige, positive Zahlen eingeben.',
        statusLabel: 'Status',
        res_shrinkage: 'Gemessene Shrinkage (Prozent) ‚Äì X',
        res_scale: 'Skalierungs‚ÄëFaktor (zur Korrektur)',
        res_corrpct: 'Empfohlene neue Korrektur (%)',
        res_delta: '√Ñnderung zu aktuell (%)',
        res_abs_error: 'Absoluter Fehler',
        phOriginal: 'z.‚ÄØB. 100',
        phPrinted: 'z.‚ÄØB. 99,7',
        phCurrentCorr: 'z.‚ÄØB. 0 (falls keine)',
        locale: 'de-DE',
      },
      'fr': { locale: 'fr-FR' }, 'es': { locale: 'es-ES' }, 'it': { locale: 'it-IT' }, 'pt-PT': { locale: 'pt-PT' },
      'nl': { locale: 'nl-NL' }, 'pl': { locale: 'pl-PL' }, 'cs': { locale: 'cs-CZ' }, 'sv': { locale: 'sv-SE' },
      'da': { locale: 'da-DK' }, 'fi': { locale: 'fi-FI' }, 'ro': { locale: 'ro-RO' }, 'bg': { locale: 'bg-BG' },
      'el': { locale: 'el-GR' }, 'et': { locale: 'et-EE' }, 'lv': { locale: 'lv-LV' }, 'lt': { locale: 'lt-LT' },
      'sl': { locale: 'sl-SI' }, 'hr': { locale: 'hr-HR' }, 'mt': { locale: 'mt-MT' }, 'ga': { locale: 'ga-IE' },
      'nb': { locale: 'nb-NO' }, 'is': { locale: 'is-IS' }, 'sq': { locale: 'sq-AL' }, 'mk': { locale: 'mk-MK' },
      'sr': { locale: 'sr-RS' }, 'bs': { locale: 'bs-BA' }, 'uk': { locale: 'uk-UA' }, 'be': { locale: 'be-BY' },
      'ru': {
        title: 'üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —É—Å–∞–¥–∫–∏',
        lead: '–í–≤–µ–¥–∏—Ç–µ <strong>–Ω–æ–º–∏–Ω–∞–ª</strong>, <strong>–∏–∑–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä</strong> –∏ –≤–∞—à—É <strong>—Ç–µ–∫—É—â—É—é –∫–æ—Ä—Ä–µ–∫—Ü–∏—é (%)</strong>. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤—ã—á–∏—Å–ª–∏—Ç —É—Å–∞–¥–∫—É –∏ <em>–Ω–æ–≤—É—é —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—É—é –∫–æ—Ä—Ä–µ–∫—Ü–∏—é (%)</em>.',
        langLabel: '–Ø–∑—ã–∫',
        unitLabel: '–ï–¥–∏–Ω–∏—Ü–∞',
        originalLabel: '–û—Ä–∏–≥–∏–Ω–∞–ª (–Ω–æ–º–∏–Ω–∞–ª)',
        printedLabel: '–ù–∞–ø–µ—á–∞—Ç–∞–Ω–æ (–∏–∑–º–µ—Ä–µ–Ω–æ)',
        currentCorrLabel: '–¢–µ–∫—É—â–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è (%)',
        unit_mm: '–ú–∏–ª–ª–∏–º–µ—Ç—Ä—ã (mm)',
        unit_inch: '–î—é–π–º—ã (inch)',
        unitNote: (u)=>`–í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ ${u}`,
        hint: '–î–æ–ø—É—Å–∫–∞—é—Ç—Å—è –∑–∞–ø—è—Ç–∞—è –∏–ª–∏ —Ç–æ—á–∫–∞ –∫–∞–∫ –¥–µ—Å—è—Ç–∏—á–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å.',
        footer: '–§–æ—Ä–º—É–ª—ã: —É—Å–∞–¥–∫–∞ % = (O ‚àí P)/O √ó 100 ¬∑ –º–∞—Å—à—Ç–∞–± = O/P ¬∑ s‚Çô = 100¬∑((O¬∑f‚Çí/P)‚àí1), –≥–¥–µ f‚Çí = 1+s‚Çí/100.',
        status_invalid: '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞.',
        statusLabel: '–°—Ç–∞—Ç—É—Å',
        res_shrinkage: '–£—Å–∞–¥–∫–∞ (–ø—Ä–æ—Ü–µ–Ω—Ç—ã) ‚Äî X',
        res_scale: '–ú–∞—Å—à—Ç–∞–± (–¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏)',
        res_corrpct: '–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –Ω–æ–≤–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è (%)',
        res_delta: '–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫ —Ç–µ–∫—É—â–µ–π (%)',
        res_abs_error: '–ê–±—Å–æ–ª—é—Ç–Ω–∞—è –æ—à–∏–±–∫–∞',
        phOriginal: '–Ω–∞–ø—Ä., 100',
        phPrinted: '–Ω–∞–ø—Ä., 99,7',
        phCurrentCorr: '–Ω–∞–ø—Ä., 0 (–µ—Å–ª–∏ –Ω–µ—Ç)',
        locale: 'ru-RU',
      },
      'tr': { locale: 'tr-TR' }, 'cy': { locale: 'cy' }, 'gd': { locale: 'gd' }, 'lb': { locale: 'lb' },
      'ca': { locale: 'ca-ES' }, 'eu': { locale: 'eu-ES' }, 'gl': { locale: 'gl-ES' },
    };

    const originalEl = $('#original');
    const printedEl  = $('#printed');
    const currentCorrEl = $('#currentCorr');
    const unitEl     = $('#unit');
    const resultsEl  = $('#results');
    const unitNoteEl = $('#unitNote');
    const langEl     = $('#lang');

    const titleEl = $('#title');
    const leadEl  = $('#lead');
    const langLabelEl = $('#langLabel');
    const unitLabelEl = $('#unitLabel');
    const originalLabelEl = $('#originalLabel');
    const printedLabelEl  = $('#printedLabel');
    const currentCorrLabelEl = $('#currentCorrLabel');
    const hintEl = $('#hint');
    const footerEl = $('#footer');

    function populateLang() {
      langEl.innerHTML = '';
      languageOptions.forEach(({code,name}) => {
        const opt = document.createElement('option');
        opt.value = code; opt.textContent = name; langEl.appendChild(opt);
      });
      langEl.value = 'en-US';
    }

    function getStrings(code){
      const base = tDict['en-US'];
      const t = tDict[code] || {};
      return { ...base, ...t };
    }

    function numberFormatter(locale){
      return new Intl.NumberFormat(locale || 'en-US', { maximumFractionDigits: 2 });
    }

    // Robust decimal parser that accepts 12 345,67 ¬∑ 12,345.67 ¬∑ 99,7 ¬∑ 99.7
    function parseDec(str){
      if (typeof str !== 'string') return NaN;
      str = str.trim().replace(/[\s\u00A0\u202F'_]/g, '');
      const hasComma = str.includes(',');
      const hasDot   = str.includes('.');

      if (hasComma && hasDot){
        const lastComma = str.lastIndexOf(',');
        const lastDot   = str.lastIndexOf('.');
        const decimalSep = lastComma > lastDot ? ',' : '.';
        if (decimalSep === ','){
          str = str.replace(/\./g, '');
          const i = str.lastIndexOf(',');
          str = str.slice(0, i).replace(/,/g, '') + '.' + str.slice(i+1);
        } else {
          str = str.replace(/,/g, '');
        }
      } else if (hasComma){
        const all = str.match(/,/g) || [];
        if (all.length > 1){
          const i = str.lastIndexOf(',');
          str = str.slice(0, i).replace(/,/g, '') + '.' + str.slice(i+1);
        } else {
          str = str.replace(',', '.');
        }
      } else if (hasDot){
        const all = str.match(/\./g) || [];
        if (all.length > 1){
          const i = str.lastIndexOf('.');
          str = str.slice(0, i).replace(/\./g, '') + '.' + str.slice(i+1);
        }
      }
      str = str.replace(/[^0-9.-]/g, '');
      str = str.replace(/(?!^)-/g, '').replace(/\.(?=.*\.)/g, '');
      return Number(str);
    }

    function row(label, value){
      return `<div class="result"><div class="label">${label}</div><div class="value">${value}</div></div>`;
    }

    function compute(){
      const T = getStrings(langEl.value);
      const nf = numberFormatter(T.locale);

      const O = parseDec(originalEl.value);
      const P = parseDec(printedEl.value);
      const sOldInput = currentCorrEl.value === '' ? '0' : currentCorrEl.value;
      const sOld = parseDec(sOldInput); // current +% correction in slicer
      const unit = unitEl.value === 'inch' ? (T.unit_inch || 'inch') : (T.unit_mm || 'mm');

      unitNoteEl.textContent = (T.unitNote || ((u)=>`All values in ${u}`))(unit);
      resultsEl.innerHTML = '';

      if (!isFinite(O) || !isFinite(P) || !isFinite(sOld) || O <= 0 || P <= 0){
        resultsEl.innerHTML = row(T.statusLabel || 'Status', T.status_invalid || getStrings('en-US').status_invalid);
        return;
      }

      const shrinkage = ((O - P) / O) * 100;  // measured shrinkage (% smaller)
      const scale     = O / P;                 // factor needed if no prior correction
      const fOld      = 1 + (sOld / 100);      // current correction factor you used
      const fNew      = (O * fOld) / P;        // recommended new factor
      const sNew      = (fNew - 1) * 100;      // recommended new +% correction
      const sDelta    = sNew - sOld;           // change vs current

      const pct = (x) => nf.format(x) + ' %';
      const fac = (x) => nf.format(x);

      resultsEl.innerHTML = [
        row(T.res_shrinkage || getStrings('en-US').res_shrinkage, pct(shrinkage)),
        row(T.res_scale || getStrings('en-US').res_scale,       fac(scale)),
        row(T.res_corrpct || getStrings('en-US').res_corrpct,   pct(sNew)),
        row(T.res_delta || getStrings('en-US').res_delta,       (sDelta>=0?'+':'') + pct(sDelta)),
        row(T.res_abs_error || getStrings('en-US').res_abs_error, `${nf.format(O - P)} ${unit}`)
      ].join('');
    }

    function applyUI(){
      const T = getStrings(langEl.value);

      titleEl.textContent = T.title || getStrings('en-US').title;
      leadEl.innerHTML = T.lead || getStrings('en-US').lead;
      langLabelEl.textContent = T.langLabel || getStrings('en-US').langLabel;
      unitLabelEl.textContent = T.unitLabel || getStrings('en-US').unitLabel;
      originalLabelEl.textContent = T.originalLabel || getStrings('en-US').originalLabel;
      printedLabelEl.textContent  = T.printedLabel  || getStrings('en-US').printedLabel;
      currentCorrLabelEl.textContent = T.currentCorrLabel || getStrings('en-US').currentCorrLabel;
      hintEl.innerHTML = T.hint || getStrings('en-US').hint;
      footerEl.innerHTML = T.footer || getStrings('en-US').footer;

      unitEl.options[0].textContent = T.unit_mm || getStrings('en-US').unit_mm;
      unitEl.options[1].textContent = T.unit_inch || getStrings('en-US').unit_inch;

      originalEl.placeholder = T.phOriginal || getStrings('en-US').phOriginal;
      printedEl.placeholder  = T.phPrinted  || getStrings('en-US').phPrinted;
      currentCorrEl.placeholder = T.phCurrentCorr || getStrings('en-US').phCurrentCorr || 'e.g., 0';

      compute();
    }

    ['input','change'].forEach(ev => {
      originalEl.addEventListener(ev, compute);
      printedEl.addEventListener(ev, compute);
      currentCorrEl.addEventListener(ev, compute);
      unitEl.addEventListener(ev, compute);
      langEl.addEventListener(ev, applyUI);
    });

    populateLang();
    applyUI();
  </script>
</body>
</html>
